(()=>{"use strict";let e=null,t=null;async function c(e,t){const c=await fetch(chrome.runtime.getURL(e)),a=await c.blob(),n=await createImageBitmap(a),o=new OffscreenCanvas(t,t).getContext("2d");if(!o)throw new Error("Failed to get canvas context");return o.drawImage(n,0,0,t,t),o.getImageData(0,0,t,t)}!async function(){try{e={16:await c("icons/icon-16.png",16),48:await c("icons/icon-48.png",48),128:await c("icons/icon-128.png",128)},t={16:await c("icons/icon-success-16.png",16),48:await c("icons/icon-success-48.png",48),128:await c("icons/icon-success-128.png",128)},console.log("Icons preloaded successfully")}catch(e){console.error("Failed to preload icons:",e)}}(),chrome.runtime.onMessage.addListener((c,a)=>{if("UPDATE_ICON"===c.type){const n=a.tab?.id;if(!n)return;c.success&&t?chrome.action.setIcon({tabId:n,imageData:t}).catch(e=>{console.error("Failed to set success icon:",e)}):e&&chrome.action.setIcon({tabId:n,imageData:e}).catch(e=>{console.error("Failed to set default icon:",e)})}}),chrome.runtime.onMessageExternal.addListener((e,t,c)=>{if("PING"===e.type)return c({type:"PONG"}),!0;if("FETCH_TRANSCRIPT"===e.type){const t=e.videoId;return chrome.tabs.create({url:`https://www.youtube.com/watch?v=${t}`,active:!1},e=>{c({success:!0,message:"Processing video..."})}),!0}})})();
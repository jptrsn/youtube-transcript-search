(()=>{"use strict";const e="https://ytscri.be",n=document.getElementById("searchInput"),t=document.getElementById("searchButton"),o=document.getElementById("message");async function c(n){try{const t=await fetch(`${e}/api/channels/resolve-handle/${n}`);return t.ok?(await t.json()).channel_id:null}catch(e){return console.error("Error resolving handle:",e),null}}async function r(e){try{console.log("Attempting to execute script in tab",e);const n=await chrome.scripting.executeScript({target:{tabId:e},func:()=>{const e=document.querySelectorAll("script");console.log("Found scripts:",e.length);for(const n of e){const e=n.textContent||"";if(e.includes("ytInitialData")){const n=e.match(/"channelId":"([^"]+)"/);if(n)return console.log("Found channel ID:",n[1]),n[1]}}return console.log("No channel ID found in scripts"),null}});return console.log("Script execution results:",n),n[0]?.result||null}catch(e){return console.error("Error getting channel from tab:",e),s(`Error: ${e}`,!0),null}}async function l(){const t=n.value.trim();if(!t)return void s("Please enter a search query",!0);s("Getting channel info...");const o=await async function(){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(console.log("Current tab:",e),!e.url)return console.log("No tab URL"),null;console.log("Tab URL:",e.url);const n=[/youtube\.com\/channel\/([^/?]+)/,/youtube\.com\/@([^/?]+)/,/youtube\.com\/watch\?v=([^&]+)/];for(const t of n){const n=e.url.match(t);if(n){const t=n[1];return e.url.includes("/@")?await c(t):e.url.includes("/watch")?await r(e.id):t}}return null}();if(!o)return void s("Please navigate to a YouTube channel or video first",!0);const l=`${e}/channel/${o}?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:l}),window.close()}function s(e,n=!1){o.textContent=e,o.className=n?"message error":"message"}t.addEventListener("click",l),n.addEventListener("keypress",e=>{"Enter"===e.key&&l()})})();